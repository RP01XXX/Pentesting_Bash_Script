#!/bin/bash
echo "###############################################################################################"
echo "Created by Tommy Canfield"
echo "Version 1, January 2024"
echo "See more at https://github.com/RP01XXX"
echo "########################################################"

#Get Time
current_time=$(date "+%m.%d.%Y-%H:%M")
echo "Current Time: $current_time"

#Build Working Directory
echo "Building Working Directory"
read -p "Engagement Title: " engagement_name

mkdir /home/kali/Desktop/$engagement_name
cd /home/kali/Desktop/$engagement_name

# In Domain Users you Must change the user file to the appropriate file

# Identify Submission
echo #
echo "You can choose to scan a single subnet by inputting the subnet or scan multiple subnets using a text file"
echo #
echo "Choose an option:"
echo "1. Single Subnet"
echo "2. Multiple Subnets"

read -p "Enter your choice (1,2,or 3): " user_choice

case $user_choice in
    1)
        read -p "Enter the single subnet: " input_option_a
        echo "You selected Option 1 with input: $input_option_a"
        ;;
    2)
        read -p "Enter the text file name: " input_option_b
        echo "You selected Option B with input: $input_option_b"
        ;;

    *)
        echo "Invalid choice. Exiting."
        exit 1
        ;;
esac

function Nmap_Identification() {
    if [ ! -z "$input_option_a" ]; then
        nmap -sP $input_option_a  |  awk '/is up/ {print up}; {gsub (/\(|\)/,""); up = $NF}' > NMAPLiveHosts.txt
     	nmap -p 389 -oG - $input_option_a | grep "open" | awk '{print $2}' > DomainControllers{$current_time}.txt
    elif [ ! -z "$input_option_b" ]; then
        nmap -sP -iL $input_option_b  |  awk '/is up/ {print up}; {gsub (/\(|\)/,""); up = $NF}' > NMAP_{$current_time}LiveHosts.txt
        nmap -p 389 -oG - -iL $input_option_b | grep "open" | awk '{print $2}' > DomainControllers{$current_time}.txt
    
    fi
}

#FULL NMAP SCAN
function Nmap_PrecisionScan() {
nmap -A -p- -iL NMAPLiveHosts.txt >> Nmap_Full_Scan_xml.xml
nmap -sU -p- -iL NMAPLiveHosts.txt >> NMAP_UDP_SCAN.txt
}

# SUBNET SHARE NULL IDENTIFICATION
function Null_Share_Hunt() {
crackmapexec smb NMAPLiveHosts.txt -u '' -p '' --shares
}

# Searching for SMB Signing Status
function SMB_Signing() {
crackmapexec smb NMAPLiveHosts.txt-u 'USERNAME' -p 'PASSWORD'  --gen-relay-list SMB_Signing_False{$engagement_name}.txt
echo "The SMB Signing Hosts are:"
cat SMB_Signing_False{$engagement_name}.txt
}

# FIND ALL HOSTNAMES
function Hostnames_Enumeration() {
crackmapexec smb NMAPLiveHosts.txt -u 'USERNAME' -p 'PASSWORD' | awk '{print $2, $11}'  > All{$engagement_name}Hostnames.txt
echo "The Hostnames Are:"
cat All{$engagement_name}Hostnames.txt
}

# FIND THE DOMAIN NAME
function Domain_Name() {
domain= crackmapexec smb NMAPLiveHosts.txt -u 'USERNAME' -p 'PASSWORD'  | awk '{print $12}' | awk '{gsub(/[()]/, ""); gsub(/domain:/,""); print}' | sort | uniq > domainName.txt

cat domainName.txt
dig domainName.txt >> DNS_Domain_Info.txt
}

#EYEWITNESS
function Eyewitness() {
eyewitness -f NMAPLiveHosts.txt --only-ports 80,8080,443,8443 --no-prompt   
}

# SSL Scan
function SSLSCAN() {
sslscan 'NMAPLiveHosts.txt' | grep enabled > SSLResults.txt
}

# Calling Functions
echo "Starting NMAP Ping Scan" 
Nmap_Identification
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo "Ping Done, Performing full NMAP scan of living hosts "
Nmap_PrecisionScan
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo "NMAP Precision Done, Hunting for Null Shares "
Null_Share_Hunt
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo "Shares Done, Searching for SMB Signing Status "
SMB_Signing
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo "SMB Signing Done, Finding Hostnames in the Subnet " 
Hostnames_Enumeration
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo "Hostname Enumeration Done, Finding the domain name and DC " 
Domain_Name
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo "Domain Discovered, Starting Eyewitness " 
Eyewitness
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo "Websites Discovered, Start the Obligatory SSL Scan " 
SSLSCAN
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo # Add a blank line after each function output bash
echo " SSLSCAN Done, Beging Nmap In-Depth Scan"


echo "All Done, Thank you and Happy Hacking"
